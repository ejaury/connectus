{% extends "base/base.html" %}

{% block ajax %}
  <script type="text/javascript">
    function enable_sorting() {
      $(function() {
        $("#sortable_students_col_1, #sortable_students_col_2").sortable({
          connectWith: '.connectedSortable',
          placeholder: 'ui-sortable-placeholder',
          update : function () { 
            var order_left = $('#sortable_students_col_1').sortable('serialize'); 
            var order_right = $('#sortable_students_col_2').sortable('serialize'); 
            $.post("/courses/{{ course_id }}/update_seating_order?"+order_left+"&"+order_right); 
          } 
        }).disableSelection();
      });

      /* Enable JEditable */
      $('.inline-editable').editable('/courses/{{ course_id }}/grades/update', {
         indicator : 'Saving...',
         tooltip   : 'Click to edit...'
      });

      $('#change_date_form').ajaxForm({
        target: '#attendance',
        success: function() {
          $('#attendance').fadeIn('slow');
        }
      });

      /* Datepicker */
      $("#id_date").datepicker({
        dateFormat: 'yy-mm-dd',
        onSelect: function() {
          $("#change_date_form").submit();
        }
      });

    }

    function ajax_submit(url) {
      $.post(url);
    }

    $.ajaxSetup ({
      cache: false
    });

    $( document ).ready( function() {
      var ajax_load = "<img src='/site_media/css/images/loading.gif' alt='loading...' />";

      // Default action
      $(function() {
        $("#content_main").html(ajax_load).load(
          '{{ default_url }}', enable_sorting);
      });

      $("#thumb_view").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.courses.views.view_seating_plan course_id %}', enable_sorting);
      });
      $("#detail_view").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.courses.views.grades course_id %}', enable_sorting);
      });

      $("#view_attendance").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.courses.views.attendance course_id %}', enable_sorting);
      });

      $("#view_grades").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.courses.views.grades course_id %}', enable_sorting);
      });

      $("#view_own_grades").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.courses.views.view_own_grades course_id %}', enable_sorting);
      });

      $("#view_gradeables").click(function(){
        $("#content_main").html(ajax_load).load(
          '{% url connectus.submissions.views.view_uploaded course_id %}', enable_sorting);
      });

      $("#view_submissions").click(function(){
        $.ajax({
          type: 'GET',
          url: '{% url connectus.submissions.views.view_submissions course_id %}',
          complete: function(xhr, text_status) {
            if (xhr.status == '302') {
              window.location.href = xhr.responseText;
            }
          },
          success: function(response, text_status, xhr) {
            $('#content_main').html(response);
          }
        });
      });

    });
  </script>

{% endblock %}

{% block head %}

  <style type="text/css">
    #sortable_students_col_1, #sortable_students_col_2 { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 80px; width: 280px;}
    #sortable_students_col_1 li, #sortable_students_col_2 li { margin: 3px 3px 3px 0; padding: 1px; float: left; width: 120px; height: 140px; text-align: center; }
    .ui-state-default {background-color:beige; border: 1px solid #CCC; }
    .ui-sortable-placeholder { border: 2px dotted gray; visibility: visible !important; height: 140px !important; background: lightblue;}
  </style>
{% endblock %}


{% block content-nav %}
  <div id="content-nav">
    <div id="content_nav_sublinks">
      {% for action_title,action in permitted_actions.items %}
        <div id="{{ action.id }}" class="content_nav_sublinks">
          <img src="/site_media/css/images/{{ action.icon_path }}" alt="{{ action_title }}" width="45" height="45"/>
          <p>{{ action_title }}</p>
        </div>
      {% endfor %}
    </div>
    <div id="content_nav_view">
      <img id="thumb_view" src="/site_media/css/images/thumb_view.png" title="Switch to Thumbnail View" alt="Thumbnail View" width="25" height="25"/>
      <img id="detail_view" src="/site_media/css/images/detail_view.png" title="Switch to Detail View" alt="Detail View" width="25" height="25"/>
    </div>
    <br/>
  </div>
{% endblock %}
